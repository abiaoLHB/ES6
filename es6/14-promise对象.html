<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title></title>

</head>

<body>
  <script>
    // const promise = new Promise(function (resolve, reject) {
    //   console.log('create-promise')
    //   setTimeout(function () {
    //     console.log('延迟')
    //     reject()
    //   }, 2000);
    // }).then(res => {
    //   console.log('hahha ')
    // }).catch(error => {
    //   console.log('shibaile')
    // })

    // const p1 = new Promise(function (resolve, reject) {
    //   setTimeout(() => reject(new Error('fail')), 3000)
    // })

    // const p2 = new Promise(function (resolve, reject) {
    //   setTimeout(() => resolve(p1), 1000)
    // })

    // p2
    //   .then(result => console.log(result))
    //   .catch(error => console.log(error))
    // // Error: fail

    // // promise 会吃掉错误
    // const someAsyncThing = function () {
    //   return new Promise(function (resolve, reject) {
    //     resolve(x + 2)
    //   })
    // }

    // someAsyncThing().then(function () {
    //   console.log("everything is great")
    // })

    // setTimeout(() => {
    //   console.log('123') //promise内部错误，但是依然会输出123.说明promise内部错误不影响promise外部
    // }, 2000);



    // const p5 = function () {
    //   return new Promise((resolve, reject) => {
    //     setTimeout(() => {
    //       console.log("p5------------")
    //       resolve()
    //     }, 2000)
    //   })
    // }
    // p5().then(res=>{
    //   console.log('p5++++')
    // }).catch(error=>{
    //   console.log("p5-error---")
    // }).finally(()=>{
    //   console.log('p5======')
    // })

    // promiseAll--只有都变成fulfileld的，promises的状态才会变成fulfiled。此时p1 p2 p3的返回值组成一个数组，传递给p的回调函数
    // 只有p1 p2 p3之中有一个被rejected，p的状态就变成rejected。此时第一个被reject的实例的返回值，会传递给p的回调函数
    const promises = [1, 2, 3, 4, 5, 6].map((itme, index, array) => {
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          if (itme > 0) {
            resolve(itme)
          } else {
            reject('promsieAll-报错了')
          }
        }, 1000);
      })
    })
    console.log(promises)

    Promise.all(promises).then(res => {
      console.log('res')
      console.log(res)
      console.log('res')
    }).catch(error => {
      console.log('error')
      console.log(error)
      console.log('error')
    })
  </script>

  <script>

    // var promise = new Promise(function (resolve,reject) {

    // })

    // promise.then(function(value){
    //   console.log('sucess')
    // },function(error){
    //   console.log('failure')
    // });


    // function timeout(ms) {
    //   return new Promise((resolve, reject) => {
    //     setTimeout(resolve, ms, 'done');
    //   });
    // }

    // timeout(100).then((value) => {
    //   console.log(value);
    // });




  </script>

  <script>
    // 封装异步下载图片
    const preloadImg = function (url) {
      return new Promise((resolve, reject) => {
        const image = new Image()
        image.onload = resolve
        image.onerror = reject
        image.src = url
      })
    }
    let url = "https://static.ukids.cn/feres/vipphone/img_nr.png"
    preloadImg(url).then(res => {
      console.log("图片下载成功")
      console.log(res)
      console.log("图片下载成功")
    }).catch(error => {
      console.log("图片下载失败")
      console.log(error)
      console.log("图片下载失败")
    })

  </script>

  
</body>

</html>